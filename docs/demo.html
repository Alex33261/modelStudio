<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="lib/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="lib/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="lib/webcomponents-2.0.0/webcomponents.js"></script>
<script src="lib/r2d3-binding-0.2.3/r2d3.js"></script>
<script src="lib/d3v4-4.13.0/d3.min.js"></script>

</head>
<body style="background-color:white;">
<div id="htmlwidget_container">
  <div id="htmlwidget-89d54e9a9748ca0f396c" style="width:960px;height:500px;" class="r2d3 html-widget"></div>
</div>
<script type="application/json" data-for="htmlwidget-89d54e9a9748ca0f396c">{"x":{"data":[{"x":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.298,"sign":"X","position":7,"label":"glm","barStart":0.298,"barSupport":0.298,"tooltipText":"Average response: 0.298<br>Prediction: 0.406"},{"variable":"gender = female","contribution":0.443,"variable_name":"gender","variable_value":"female","cummulative":0.741,"sign":"1","position":6,"label":"glm","barStart":0.298,"barSupport":0.7407,"tooltipText":"gender = female<br>increases average response <br>by 0.443"},{"variable":"age = 59","contribution":-0.299,"variable_name":"age","variable_value":"59","cummulative":0.442,"sign":"-1","position":5,"label":"glm","barStart":0.4415,"barSupport":0.7407,"tooltipText":"age = 59<br>decreases average response <br>by 0.299"},{"variable":"class = 2nd","contribution":-0.065,"variable_name":"class","variable_value":"2nd","cummulative":0.377,"sign":"-1","position":4,"label":"glm","barStart":0.3768,"barSupport":0.4415,"tooltipText":"class = 2nd<br>decreases average response <br>by 0.065"},{"variable":"sibsp = 0","contribution":0.033,"variable_name":"sibsp","variable_value":"0","cummulative":0.41,"sign":"1","position":3,"label":"glm","barStart":0.3768,"barSupport":0.4097,"tooltipText":"sibsp = 0<br>increases average response <br>by 0.033"},{"variable":"fare = 26","contribution":-0.003,"variable_name":"fare","variable_value":"26","cummulative":0.406,"sign":"-1","position":2,"label":"glm","barStart":0.4064,"barSupport":0.4097,"tooltipText":"fare = 26<br>decreases average response <br>by 0.003"},{"variable":"prediction","contribution":0.108,"variable_name":"prediction","variable_value":"","cummulative":0.406,"sign":"X","position":1,"label":"glm","barStart":0.298,"barSupport":0.4064,"tooltipText":"Average response: 0.298<br>Prediction: 0.406"}],"m":[7],"label_list":["intercept","gender = female","age = 59","class = 2nd","sibsp = 0","fare = 26","prediction"],"variables":["gender","age","class","sibsp","fare"],"x_min_max":[0.2094,0.8296],"otherFactorsFlag":[false]},{"observation":[{"observation.id":"942","model":"glm","yhat":0.4064,"gender":"female","age":59,"class":"2nd","fare":26,"sibsp":0}],"x":{"gender":[{"xhat":"male","yhat":0.0328,"vname":"gender"},{"xhat":"female","yhat":0.4064,"vname":"gender"}],"age":[{"xhat":0.3333,"yhat":0.9428,"id":"942","vname":"age"},{"xhat":0.9983,"yhat":0.9408,"id":"942","vname":"age"},{"xhat":3,"yhat":0.9345,"id":"942","vname":"age"},{"xhat":5,"yhat":0.9275,"id":"942","vname":"age"},{"xhat":10.92,"yhat":0.9028,"id":"942","vname":"age"},{"xhat":13.95,"yhat":0.8874,"id":"942","vname":"age"},{"xhat":15,"yhat":0.8816,"id":"942","vname":"age"},{"xhat":16.93,"yhat":0.8702,"id":"942","vname":"age"},{"xhat":17,"yhat":0.8698,"id":"942","vname":"age"},{"xhat":18,"yhat":0.8635,"id":"942","vname":"age"},{"xhat":19,"yhat":0.857,"id":"942","vname":"age"},{"xhat":20,"yhat":0.8502,"id":"942","vname":"age"},{"xhat":21,"yhat":0.8432,"id":"942","vname":"age"},{"xhat":22,"yhat":0.8358,"id":"942","vname":"age"},{"xhat":23,"yhat":0.8283,"id":"942","vname":"age"},{"xhat":24,"yhat":0.8204,"id":"942","vname":"age"},{"xhat":25,"yhat":0.8123,"id":"942","vname":"age"},{"xhat":25.63,"yhat":0.807,"id":"942","vname":"age"},{"xhat":26,"yhat":0.8039,"id":"942","vname":"age"},{"xhat":27,"yhat":0.7952,"id":"942","vname":"age"},{"xhat":28,"yhat":0.7862,"id":"942","vname":"age"},{"xhat":29,"yhat":0.777,"id":"942","vname":"age"},{"xhat":30,"yhat":0.7674,"id":"942","vname":"age"},{"xhat":31,"yhat":0.7576,"id":"942","vname":"age"},{"xhat":32,"yhat":0.7475,"id":"942","vname":"age"},{"xhat":33,"yhat":0.7371,"id":"942","vname":"age"},{"xhat":33.37,"yhat":0.7332,"id":"942","vname":"age"},{"xhat":34,"yhat":0.7265,"id":"942","vname":"age"},{"xhat":35,"yhat":0.7156,"id":"942","vname":"age"},{"xhat":36,"yhat":0.7044,"id":"942","vname":"age"},{"xhat":37,"yhat":0.693,"id":"942","vname":"age"},{"xhat":38,"yhat":0.6814,"id":"942","vname":"age"},{"xhat":39,"yhat":0.6695,"id":"942","vname":"age"},{"xhat":40,"yhat":0.6574,"id":"942","vname":"age"},{"xhat":41,"yhat":0.645,"id":"942","vname":"age"},{"xhat":42,"yhat":0.6325,"id":"942","vname":"age"},{"xhat":43,"yhat":0.6198,"id":"942","vname":"age"},{"xhat":44.15,"yhat":0.605,"id":"942","vname":"age"},{"xhat":45,"yhat":0.594,"id":"942","vname":"age"},{"xhat":45.13,"yhat":0.5923,"id":"942","vname":"age"},{"xhat":46,"yhat":0.5808,"id":"942","vname":"age"},{"xhat":47,"yhat":0.5676,"id":"942","vname":"age"},{"xhat":48,"yhat":0.5542,"id":"942","vname":"age"},{"xhat":49,"yhat":0.5408,"id":"942","vname":"age"},{"xhat":50.06,"yhat":0.5265,"id":"942","vname":"age"},{"xhat":52.05,"yhat":0.4995,"id":"942","vname":"age"},{"xhat":56,"yhat":0.4462,"id":"942","vname":"age"},{"xhat":58,"yhat":0.4196,"id":"942","vname":"age"},{"xhat":59,"yhat":0.4064,"id":"942","vname":"age"},{"xhat":62.01,"yhat":0.3677,"id":"942","vname":"age"},{"xhat":74,"yhat":0.2329,"id":"942","vname":"age"}],"class":[{"xhat":"2nd","yhat":0.4064,"vname":"class"},{"xhat":"3rd","yhat":0.2965,"vname":"class"},{"xhat":"restaurant staff","yhat":0.1284,"vname":"class"},{"xhat":"victualling crew","yhat":0.4661,"vname":"class"},{"xhat":"deck crew","yhat":0.9334,"vname":"class"},{"xhat":"1st","yhat":0.8593,"vname":"class"},{"xhat":"engineering crew","yhat":0.4502,"vname":"class"}],"sibsp":[{"xhat":0,"yhat":0.4064,"id":"942","vname":"sibsp"},{"xhat":1,"yhat":0.2639,"id":"942","vname":"sibsp"},{"xhat":2,"yhat":0.158,"id":"942","vname":"sibsp"},{"xhat":4,"yhat":0.0489,"id":"942","vname":"sibsp"},{"xhat":5,"yhat":0.0262,"id":"942","vname":"sibsp"},{"xhat":8,"yhat":0.0039,"id":"942","vname":"sibsp"}],"fare":[{"xhat":0,"yhat":0.4177,"id":"942","vname":"fare"},{"xhat":6.1445,"yhat":0.415,"id":"942","vname":"fare"},{"xhat":7.0407,"yhat":0.4146,"id":"942","vname":"fare"},{"xhat":7.0806,"yhat":0.4146,"id":"942","vname":"fare"},{"xhat":7.1454,"yhat":0.4146,"id":"942","vname":"fare"},{"xhat":7.15,"yhat":0.4146,"id":"942","vname":"fare"},{"xhat":7.1506,"yhat":0.4146,"id":"942","vname":"fare"},{"xhat":7.1701,"yhat":0.4145,"id":"942","vname":"fare"},{"xhat":7.1709,"yhat":0.4145,"id":"942","vname":"fare"},{"xhat":7.1711,"yhat":0.4145,"id":"942","vname":"fare"},{"xhat":7.1806,"yhat":0.4145,"id":"942","vname":"fare"},{"xhat":8.01,"yhat":0.4142,"id":"942","vname":"fare"},{"xhat":8.0557,"yhat":0.4142,"id":"942","vname":"fare"},{"xhat":8.4771,"yhat":0.414,"id":"942","vname":"fare"},{"xhat":9.1039,"yhat":0.4137,"id":"942","vname":"fare"},{"xhat":10.1,"yhat":0.4133,"id":"942","vname":"fare"},{"xhat":11.0611,"yhat":0.4129,"id":"942","vname":"fare"},{"xhat":12.4443,"yhat":0.4123,"id":"942","vname":"fare"},{"xhat":13,"yhat":0.412,"id":"942","vname":"fare"},{"xhat":13.1506,"yhat":0.412,"id":"942","vname":"fare"},{"xhat":14.0829,"yhat":0.4116,"id":"942","vname":"fare"},{"xhat":14.1,"yhat":0.4116,"id":"942","vname":"fare"},{"xhat":15.057,"yhat":0.4111,"id":"942","vname":"fare"},{"xhat":16.02,"yhat":0.4107,"id":"942","vname":"fare"},{"xhat":18.0375,"yhat":0.4098,"id":"942","vname":"fare"},{"xhat":20.3241,"yhat":0.4089,"id":"942","vname":"fare"},{"xhat":22.2841,"yhat":0.408,"id":"942","vname":"fare"},{"xhat":26,"yhat":0.4064,"id":"942","vname":"fare"},{"xhat":26.0509,"yhat":0.4064,"id":"942","vname":"fare"},{"xhat":26.11,"yhat":0.4064,"id":"942","vname":"fare"},{"xhat":27.1405,"yhat":0.4059,"id":"942","vname":"fare"},{"xhat":28.1069,"yhat":0.4055,"id":"942","vname":"fare"},{"xhat":30,"yhat":0.4047,"id":"942","vname":"fare"},{"xhat":31.0709,"yhat":0.4042,"id":"942","vname":"fare"},{"xhat":31.2665,"yhat":0.4042,"id":"942","vname":"fare"},{"xhat":36.2605,"yhat":0.402,"id":"942","vname":"fare"},{"xhat":39.3685,"yhat":0.4007,"id":"942","vname":"fare"},{"xhat":46.6102,"yhat":0.3976,"id":"942","vname":"fare"},{"xhat":52.1101,"yhat":0.3952,"id":"942","vname":"fare"},{"xhat":55.3672,"yhat":0.3938,"id":"942","vname":"fare"},{"xhat":63.2246,"yhat":0.3905,"id":"942","vname":"fare"},{"xhat":69.3893,"yhat":0.3879,"id":"942","vname":"fare"},{"xhat":76.1953,"yhat":0.385,"id":"942","vname":"fare"},{"xhat":82.0994,"yhat":0.3825,"id":"942","vname":"fare"},{"xhat":91.3703,"yhat":0.3786,"id":"942","vname":"fare"},{"xhat":113.2591,"yhat":0.3695,"id":"942","vname":"fare"},{"xhat":146.2017,"yhat":0.3559,"id":"942","vname":"fare"},{"xhat":221.4102,"yhat":0.3257,"id":"942","vname":"fare"},{"xhat":512.0607,"yhat":0.2234,"id":"942","vname":"fare"}]},"y_min_max":[-0.09,1.0367],"x_min_max_list":{"age":[[0.3333],[74]],"sibsp":[[0],[8]],"fare":[[0],[512.0607]]},"is_numeric":[false,true,false,true,true],"variables":["gender","age","class","sibsp","fare"]},{"x":[{"variable":"fare","dropout_loss":0.3699,"full_model":0.3691},{"variable":"sibsp","dropout_loss":0.3783,"full_model":0.3691},{"variable":"age","dropout_loss":0.4026,"full_model":0.3691},{"variable":"class","dropout_loss":0.4461,"full_model":0.3691},{"variable":"gender","dropout_loss":0.4873,"full_model":0.3691}],"x_min_max":[0.3454,0.511]},{}],"type":"json","container":"svg","options":{"size":2,"alpha":1,"bar_width":16,"cp_title":"Ceteris Paribus Profiles","bd_title":"Break Down","fi_title":"Feature Importance","model_name":"glm","show_rugs":true},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  C:/Users/Hubert/Documents/R/win-library/3.6/dime/d3js/colorsDrWhy.js */\nfunction getColors(n, type){\n  // get drWhy palette\n\n  var temp = [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n  var ret = [];\n\n  if (type == \"bar\") {\n    switch(n){\n      case 1:\n        return [\"#46bac2\"];\n      case 2:\n        return [\"#46bac2\", \"#4378bf\"];\n      case 3:\n        return [\"#8bdcbe\", \"#4378bf\", \"#46bac2\"];\n      case 4:\n        return [\"#46bac2\", \"#371ea3\", \"#8bdcbe\", \"#4378bf\"];\n      case 5:\n        return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ffa58c\"];\n      case 6:\n        return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\"];\n      case 7:\n        return temp;\n      default:\n        for (var i = 0; i <= n%7; i++) {\n          ret = ret.concat(temp);\n        }\n        return ret;\n    }\n  } else if (type == \"line\") {\n    switch(n){\n      case 1:\n        return [\"#46bac2\"];\n      case 2:\n        return [\"#8bdcbe\", \"#4378bf\"];\n      case 3:\n        return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\"];\n      case 4:\n        return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ffa58c\"];\n      case 5:\n        return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ae2c87\", \"#ffa58c\"];\n      case 6:\n        return [\"#8bdcbe\", \"#f05a71\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n      case 7:\n        return temp;\n      default:\n        for (var j = 0; j <= n%7; j++) {\n          ret = ret.concat(temp);\n        }\n        return ret;\n    }\n  } else if (type == \"point\") {\n    switch(n){\n      default:\n        return [\"#371ea3\", \"#46bac2\", \"#ceced9\"];\n    }\n  } else if (type == \"breakDown\") {\n    switch(n){\n      default:\n        return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\"];\n    }\n  }\n}\n\nfunction getTickValues(domain) {\n  // find 5 nice ticks with max and min - do better than d3\n\n  var tickValues = d3.ticks(domain[0], domain[1],5);\n\n  switch (tickValues.length){\n    case 3:\n      tickValues.unshift(domain[0]);\n      tickValues.push(domain[1]);\n      break;\n\n    case 4:\n      if(Math.abs(domain[0] - tickValues[0]) < Math.abs(domain[1] - tickValues[3])){\n        tickValues.shift();\n        tickValues.unshift(domain[0]);\n        tickValues.push(domain[1]);\n      } else {\n        tickValues.pop();\n        tickValues.push(domain[1]);\n        tickValues.unshift(domain[0]);\n      }\n      break;\n\n    case 5:\n      tickValues.pop();\n      tickValues.shift();\n      tickValues.push(domain[1]);\n      tickValues.unshift(domain[0]);\n      break;\n\n    case 6:\n      if(Math.abs(domain[0] - tickValues[0]) < Math.abs(domain[1] - tickValues[5])){\n        tickValues.pop();\n        tickValues.shift();\n        tickValues.shift();\n        tickValues.push(domain[1]);\n        tickValues.unshift(domain[0]);\n      } else {\n        tickValues.pop();\n        tickValues.pop();\n        tickValues.shift();\n        tickValues.push(domain[1]);\n        tickValues.unshift(domain[0]);\n      }\n      break;\n\n    case 7:\n      tickValues.pop();\n      tickValues.pop();\n      tickValues.shift();\n      tickValues.shift();\n      tickValues.push(domain[1]);\n      tickValues.unshift(domain[0]);\n      break;\n\n    case 8:\n      if(Math.abs(domain[0] - tickValues[0]) < Math.abs(domain[1] - tickValues[7])){\n        tickValues.pop();\n        tickValues.pop();\n        tickValues.shift();\n        tickValues.shift();\n        tickValues.shift();\n        tickValues.push(domain[1]);\n        tickValues.unshift(domain[0]);\n      } else {\n        tickValues.pop();\n        tickValues.pop();\n        tickValues.pop();\n        tickValues.shift();\n        tickValues.shift();\n        tickValues.push(domain[1]);\n        tickValues.unshift(domain[0]);\n      }\n      break;\n    }\n\n  return tickValues;\n}\n\nfunction calculateTextWidth(text) {\n  // calculate max width of 11px text array\n\n  var temp = svg.selectAll()\n                .data(text)\n                .enter();\n\n  var textWidth = [];\n\n  temp.append(\"text\")\n      .attr(\"class\", \"toRemove\")\n      .text(function(d) { return d;})\n      .style(\"font-size\", \"11px\")\n      .style('font-family', 'Fira Sans, sans-serif')\n      .each(function(d,i) {\n          var thisWidth = this.getComputedTextLength();\n          textWidth.push(thisWidth);\n      });\n\n  svg.selectAll('.toRemove').remove();\n  temp.remove();\n\n  var maxLength = d3.max(textWidth);\n\n  return maxLength;\n}\n\nfunction getTextWidth(text, fontSize, fontFace) {\n  // calculate width of single text\n\n  var canvas = document.createElement('canvas');\n  var context = canvas.getContext('2d');\n  context.font = fontSize + 'px ' + fontFace;\n  return context.measureText(text).width;\n}\n\n/* R2D3 Source File:  C:/Users/Hubert/Documents/R/win-library/3.6/dime/d3js/tooltipD3.js */\n// TOOLTIP\n\n// d3.tip\n// Copyright (c) 2013 Justin Palmer\n// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete\n// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz\n//\n// Tooltips for d3.js SVG visualizations\n\nd3.functor = function functor(v) {\n  return typeof v === \"function\" ? v : function() {\n    return v;\n  };\n};\n\nd3.tip = function() {\n\n  var direction = d3_tip_direction,\n      offset    = d3_tip_offset,\n      html      = d3_tip_html,\n      node      = initNode(),\n      svg       = null,\n      point     = null,\n      target    = null\n\n  function tip(vis) {\n    svg = getSVGNode(vis)\n    point = svg.createSVGPoint()\n    document.body.appendChild(node)\n  }\n\n  // Public - show the tooltip on the screen\n  //\n  // Returns a tip\n  tip.show = function() {\n    var args = Array.prototype.slice.call(arguments)\n    if(args[args.length - 1] instanceof SVGElement) target = args.pop()\n\n    var content = html.apply(this, args),\n        poffset = offset.apply(this, args),\n        dir     = direction.apply(this, args),\n        nodel   = getNodeEl(),\n        i       = directions.length,\n        coords,\n        scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,\n        scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft\n\n    nodel.html(content)\n      .style('position', 'absolute')\n      .style('opacity', 1)\n      .style('pointer-events', 'all')\n\n    while(i--) nodel.classed(directions[i], false)\n    coords = direction_callbacks[dir].apply(this)\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n\n    var divDim = node.getBoundingClientRect(),\n        svgDim = svg.getBBox();\n\n    if (d3.event.pageY + divDim.height > svgDim.height) {\n      nodel.classed(dir, true).style('top', (d3.event.pageY - divDim.height - 10) + scrollTop  + 'px');\n    } else {\n      nodel.classed(dir, true).style('top', (d3.event.pageY + 10) + scrollTop  + 'px');\n    }\n\n    if (d3.event.pageX + divDim.width/2 > svgDim.width) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width - 10) + scrollLeft + 'px');\n    } else if (d3.event.pageX - divDim.width/2 < 5) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX + divDim.width + 10) + scrollLeft + 'px');\n    } else {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width/2) + scrollLeft + 'px');\n    }\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n    return tip\n  }\n\n  // Public - hide the tooltip\n  //\n  // Returns a tip\n  tip.hide = function() {\n    var nodel = getNodeEl()\n    nodel\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n    return tip\n  }\n\n  // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.\n  //\n  // n - name of the attribute\n  // v - value of the attribute\n  //\n  // Returns tip or attribute value\n  tip.attr = function(n, v) {\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().attr(n)\n    } else {\n      var args =  Array.prototype.slice.call(arguments)\n      d3.selection.prototype.attr.apply(getNodeEl(), args)\n    }\n\n    return tip\n  }\n\n  // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.\n  //\n  // n - name of the property\n  // v - value of the property\n  //\n  // Returns tip or style property value\n  tip.style = function(n, v) {\n    // debugger;\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().style(n)\n    } else {\n      var args = Array.prototype.slice.call(arguments);\n      if (args.length === 1) {\n        var styles = args[0];\n        Object.keys(styles).forEach(function(key) {\n          return d3.selection.prototype.style.apply(getNodeEl(), [key, styles[key]]);\n        });\n      }\n    }\n\n    return tip\n  }\n\n  // Public: Set or get the direction of the tooltip\n  //\n  // v - One of n(north), s(south), e(east), or w(west), nw(northwest),\n  //     sw(southwest), ne(northeast) or se(southeast)\n  //\n  // Returns tip or direction\n  tip.direction = function(v) {\n    if (!arguments.length) return direction\n    direction = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: Sets or gets the offset of the tip\n  //\n  // v - Array of [x, y] offset\n  //\n  // Returns offset or\n  tip.offset = function(v) {\n    if (!arguments.length) return offset\n    offset = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: sets or gets the html value of the tooltip\n  //\n  // v - String value of the tip\n  //\n  // Returns html value or tip\n  tip.html = function(v) {\n    if (!arguments.length) return html\n    html = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: destroys the tooltip and removes it from the DOM\n  //\n  // Returns a tip\n  tip.destroy = function() {\n    if(node) {\n      getNodeEl().remove();\n      node = null;\n    }\n    return tip;\n  }\n\n  function d3_tip_direction() { return 'n' }\n  function d3_tip_offset() { return [0, 0] }\n  function d3_tip_html() { return ' ' }\n\n  var direction_callbacks = {\n    n:  direction_n,\n    s:  direction_s,\n    e:  direction_e,\n    w:  direction_w,\n    nw: direction_nw,\n    ne: direction_ne,\n    sw: direction_sw,\n    se: direction_se\n  };\n\n  var directions = Object.keys(direction_callbacks);\n\n  function direction_n() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.n.y - node.offsetHeight,\n      left: bbox.n.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_s() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.s.y,\n      left: bbox.s.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_e() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.e.y - node.offsetHeight / 2,\n      left: bbox.e.x\n    }\n  }\n\n  function direction_w() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.w.y - node.offsetHeight / 2,\n      left: bbox.w.x - node.offsetWidth\n    }\n  }\n\n  function direction_nw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.nw.y - node.offsetHeight,\n      left: bbox.nw.x - node.offsetWidth\n    }\n  }\n\n  function direction_ne() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.ne.y - node.offsetHeight,\n      left: bbox.ne.x\n    }\n  }\n\n  function direction_sw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.sw.y,\n      left: bbox.sw.x - node.offsetWidth\n    }\n  }\n\n  function direction_se() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.se.y,\n      left: bbox.e.x\n    }\n  }\n\n  function initNode() {\n    var node = d3.select(document.createElement('div'))\n    node\n      .style('position', 'absolute')\n      .style('top', 0)\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n      .style('box-sizing', 'border-box')\n      .style('line-heigh', 1.1)\n      .style('padding', '6px')\n      .style('background', \"#000000c0\")\n      .style('color', '#fff')\n      .style('font-size', '14px')\n      .style('font-family', \"'Roboto Condensed', sans-serif\");\n\n    return node.node()\n  }\n\n\n  function getSVGNode(el) {\n    el = el.node()\n    if(el.tagName.toLowerCase() === 'svg')\n      return el\n\n    return el.ownerSVGElement\n  }\n\n  function getNodeEl() {\n    if(node === null) {\n      node = initNode();\n      // re-add node to DOM\n      document.body.appendChild(node);\n    };\n    return d3.select(node);\n  }\n\n  // Returns an Object {n, s, e, w, nw, sw, ne, se}\n  function getScreenBBox() {\n    var targetel   = target || d3.event.target;\n\n    while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {\n        targetel = targetel.parentNode;\n    }\n\n    var bbox       = {},\n        matrix     = targetel.getScreenCTM(),\n        tbbox      = targetel.getBBox(),\n        width      = tbbox.width,\n        height     = tbbox.height,\n        x          = tbbox.x,\n        y          = tbbox.y\n\n    point.x = x\n    point.y = y\n    bbox.nw = point.matrixTransform(matrix)\n    point.x += width\n    bbox.ne = point.matrixTransform(matrix)\n    point.y += height\n    bbox.se = point.matrixTransform(matrix)\n    point.x -= width\n    bbox.sw = point.matrixTransform(matrix)\n    point.y -= height / 2\n    bbox.w  = point.matrixTransform(matrix)\n    point.x += width\n    bbox.e = point.matrixTransform(matrix)\n    point.x -= width / 2\n    point.y -= height / 2\n    bbox.n = point.matrixTransform(matrix)\n    point.y += height\n    bbox.s = point.matrixTransform(matrix)\n\n    return bbox\n  }\n\n  return tip\n};\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  C:/Users/Hubert/Documents/R/win-library/3.6/dime/d3js/modelStudio.js */\n/// load all data\nvar bdData = data[0],\n    cpData = data[1],\n    fiData = data[2];\n\nvar cpPlotCount = bdData.variables.length,\n    bdBarCount = bdData.m[0],\n    fiBarCount = bdData.m[0] - 1;\n\n/// load options\nvar size = options.size, alpha = options.alpha, barWidth = options.bar_width,\n    cpTitle = options.cp_title, bdTitle = options.bd_title, fiTitle = options.fi_title,\n    modelName = options.model_name,\n    showRugs = options.show_rugs;\n\n// calculate BD left margin\nvar maxLength = calculateTextWidth(bdData.label_list)+15;\n\nvar margin = {top: 100, right: 20, bottom: 70, left: maxLength, inner: 40},\n    w = width - margin.left - margin.right,\n    h = height - margin.top - margin.bottom,\n    plotTop = margin.top, plotLeft = margin.left,\n    plotHeight = 600, plotWidth = 900;\n\n/// set plot specific measures and colors\nvar bdPlotHeight = bdBarCount*barWidth + (bdBarCount+1)*barWidth/2,\n    bdPlotWidth = 420;\n\nif (bdPlotHeight<280) {\n  bdBarWidth = 280/(3*bdBarCount/2 + 1/2);\n  bdPlotHeight = 280;\n}\n\nvar bdColors = getColors(3, \"breakDown\"),\n    positiveColor = bdColors[0],\n    negativeColor = bdColors[1],\n    defaultColor = bdColors[2];\n\nvar cpPlotHeight = 280,\n    cpPlotWidth = 420;\n\nvar cpColors = getColors(3, \"point\"),\n    pointColor = cpColors[0],\n    lineColor = cpColors[1],\n    greyColor = cpColors[2];\n\nvar fiPlotHeight = fiBarCount*barWidth + (fiBarCount+1)*barWidth/2,\n    fiPlotWidth = 420;\n\nif (fiPlotHeight<280) {\n  fiBarWidth = 280/(3*fiBarCount/2 + 1/2);\n  fiPlotHeight= 280;\n}\n\nvar fiColors = getColors(1, \"bar\"),\n    barColor = fiColors[0];\n///\n\n/// plot\nvar BD = svg.append(\"g\");\nbreakDown();\nplotLeft = 80;\n\nvar CP = svg.append(\"g\").attr(\"transform\", \"translate(\" +\n                              (bdPlotWidth + margin.left + margin.right) + \",0)\");\nceterisParibus();\n\nplotLeft = maxLength;\nvar FI = svg.append(\"g\").attr(\"transform\", \"translate(0,\"+\n                              (bdPlotHeight + margin.top + margin.bottom) + \")\");\nfeatureImportance();\nplotLeft = 80;\n\nvar PD = svg.append(\"g\").attr(\"transform\", \"translate(\" +\n                              (bdPlotWidth + margin.left + margin.right) + \",\" +\n                              (bdPlotHeight + margin.top + margin.bottom) + \")\");\npartialDependency();\n///\n\n\nfunction breakDown() {\n\n  var bData = bdData.x;\n  var xMinMax = bdData.x_min_max;\n\n  var x = d3.scaleLinear()\n        .range([plotLeft,  plotLeft + bdPlotWidth])\n        .domain([xMinMax[0], xMinMax[1]]);\n\n  var xAxis = d3.axisBottom(x)\n              .ticks(5)\n              .tickSize(0);\n\n  xAxis = BD.append(\"g\")\n          .attr(\"class\", \"axisLabel\")\n          .attr(\"transform\", \"translate(0,\" + (plotTop + bdPlotHeight) + \")\")\n          .call(xAxis)\n          .call(g => g.select(\".domain\").remove());\n\n  var y = d3.scaleBand()\n        .rangeRound([plotTop, plotTop + bdPlotHeight])\n        .padding(0.33)\n        .domain(bData.map(function (d) {\n             return d.variable;\n        }));\n\n  var xGrid = BD.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(0,\" + (plotTop + bdPlotHeight) + \")\")\n         .call(d3.axisBottom(x)\n                .ticks(10)\n                .tickSize(-bdPlotHeight)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yGrid = BD.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(\" + plotLeft + \",0)\")\n         .call(d3.axisLeft(y)\n                .tickSize(-bdPlotWidth)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n        .tickSize(0);\n\n  yAxis = BD.append(\"g\")\n        .attr(\"class\", \"axisLabel\")\n        .attr(\"transform\",\"translate(\" + (plotLeft-10) + \",0)\")\n        .call(yAxis)\n        .call(g => g.select(\".domain\").remove());\n\n  yAxis.select(\".tick:last-child\").select(\"text\").attr('font-weight', 600);\n\n  BD.append(\"text\")\n        .attr(\"x\", plotLeft)\n        .attr(\"y\", plotTop - 15)\n        .attr(\"class\", \"smallTitle\")\n        .text(modelName);\n\n  BD.append(\"text\")\n        .attr(\"x\", plotLeft)\n        .attr(\"y\", plotTop - 40)\n        .attr(\"class\", \"bigTitle\")\n        .text(bdTitle);\n\n  // add tooltip\n  var tool_tip = d3.tip()\n        .attr(\"class\", \"tooltip\")\n        .offset([-8, 0])\n        .html(function(d) { return bdTooltipHtml(d); });\n\n  BD.call(tool_tip);\n\n  // find boundaries\n  let intercept = bData[0].contribution > 0 ? bData[0].barStart : bData[0].barSupport;\n\n  // make dotted line from intercept to prediction\n  var dotLineData = [{\"x\": x(intercept), \"y\": y(\"intercept\")},\n                     {\"x\": x(intercept), \"y\": y(\"prediction\") + bdBarWidth}];\n\n  var lineFunction = d3.line()\n                         .x(function(d) { return d.x; })\n                         .y(function(d) { return d.y; });\n  BD.append(\"path\")\n        .data([dotLineData])\n        .attr(\"class\", \"dotLine\")\n        .attr(\"d\", lineFunction)\n        .style(\"stroke-dasharray\", (\"1, 2\"));\n\n  // add bars\n  var bars = BD.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  bars.append(\"rect\")\n        .attr(\"class\", modelName.replace(/\\s/g,''))\n        .attr(\"fill\",function(d){\n          switch(d.sign){\n            case \"-1\":\n              return negativeColor;\n            case \"1\":\n              return positiveColor;\n            default:\n              return defaultColor;\n          }\n        })\n        .attr(\"fill-opacity\",\n        d => x(d.barSupport)-x(d.barStart) < 1 ? 0 : 1) //invisible bar for clicking purpose\n        .attr(\"y\", d => y(d.variable) )\n        .attr(\"height\", y.bandwidth() )\n        .attr(\"x\", d => x(d.barStart))\n        .attr(\"width\", d => x(d.barSupport)-x(d.barStart) < 1 ? 5 : x(d.barSupport) - x(d.barStart))\n        .on('mouseover', tool_tip.show)\n        .on('mouseout', tool_tip.hide)\n        .attr(\"id\", (d,i) => i-1)\n        .on(\"click\", function(){\n          clicked = this.id;\n          updateCP(this.id);\n        });\n\n  // add labels to bars\n  var contributionLabel = BD.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  contributionLabel.append(\"text\")\n        .attr(\"x\", d => {\n          switch(d.sign){\n            case \"X\":\n              return d.contribution < 0 ? x(d.barStart) - 5 : x(d.barSupport) + 5;\n            default:\n              return x(d.barSupport) + 5;\n          }\n        })\n        .attr(\"text-anchor\", d => d.sign == \"X\" && d.contribution < 0 ? \"end\" : null)\n        .attr(\"y\", d => y(d.variable) + bdBarWidth/2)\n        .attr(\"dy\", \"0.5em\")\n        .attr(\"class\", \"axisLabel\")\n        .text(d => {\n          switch(d.variable){\n            case \"intercept\":\n            case \"prediction\":\n              return d.cummulative;\n            default:\n              return d.sign === \"-1\" ? d.contribution : \"+\"+d.contribution;\n          }\n        });\n\n  // add lines to bars\n  var lines = BD.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  lines.append(\"line\")\n        .attr(\"class\", \"interceptLine\")\n        .attr(\"x1\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y1\", d => y(d.variable))\n        .attr(\"x2\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y2\", d => d.variable == \"prediction\" ? y(d.variable) : y(d.variable) + bdBarWidth*2.5);\n}\n\nfunction ceterisParibus() {\n\n  var profData = cpData.x;\n  var xMinMax = cpData.x_min_max_list;\n  var yMinMax = cpData.y_min_max;\n  var obsData = cpData.observation;\n  var isNumeric = cpData.is_numeric;\n  var variables = cpData.variables;\n\n  var start = 1;\n\n  let variableName = variables[start];\n\n  //lines or bars?\n  if (isNumeric[start]) {\n    cpNumericalPlot(variableName, profData[variableName], xMinMax[variableName],\n                    yMinMax, obsData, start+1);\n  } else {\n    cpCategoricalPlot(variableName, profData[variableName],\n                      yMinMax, obsData, start+1);\n  }\n}\n\nfunction featureImportance() {\n\n  var bData = fiData.x;\n  var xMinMax = fiData.x_min_max;\n\n  var x = d3.scaleLinear()\n            .range([plotLeft, plotLeft + fiPlotWidth])\n            .domain([xMinMax[0], xMinMax[1]]);\n\n  FI.append(\"text\")\n    .attr(\"transform\",\n          \"translate(\" + (plotLeft + fiPlotWidth + margin.right)/2 + \" ,\" +\n                         (plotTop + fiPlotHeight + 45) + \")\")\n    .attr(\"class\", \"axisTitle\")\n    .text(\"Drop-out loss\");\n\n  var xAxis = d3.axisBottom(x)\n              .ticks(5)\n              .tickSize(0);\n\n  xAxis = FI.append(\"g\")\n            .attr(\"class\", \"axisLabel\")\n            .attr(\"transform\", \"translate(0,\" + (plotTop + fiPlotHeight) + \")\")\n            .call(xAxis)\n            .call(g => g.select(\".domain\").remove());\n\n  var y = d3.scaleBand()\n            .rangeRound([plotTop + fiPlotHeight, plotTop])\n            .padding(0.33)\n            .domain(bData.map(function (d) {\n                 return d.variable;\n            }));\n\n  var xGrid = FI.append(\"g\")\n                .attr(\"class\", \"grid\")\n                .attr(\"transform\", \"translate(0,\" + (plotTop + fiPlotHeight) + \")\")\n                .call(d3.axisBottom(x)\n                        .ticks(10)\n                        .tickSize(-fiPlotHeight)\n                        .tickFormat(\"\")\n                ).call(g => g.select(\".domain\").remove());\n\n  var yGrid = FI.append(\"g\")\n                .attr(\"class\", \"grid\")\n                .attr(\"transform\", \"translate(\" + plotLeft + \",0)\")\n                .call(d3.axisLeft(y)\n                        .tickSize(-fiPlotWidth)\n                        .tickFormat(\"\")\n                ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n                .tickSize(0);\n\n  yAxis = FI.append(\"g\")\n      .attr(\"class\", \"axisLabel\")\n      .attr(\"transform\",\"translate(\" + (plotLeft-10) + \",0)\")\n      .call(yAxis)\n      .call(g => g.select(\".domain\").remove());\n\n  FI.append(\"text\")\n    .attr(\"x\", plotLeft)\n    .attr(\"y\", plotTop - 40)\n    .attr(\"class\", \"bigTitle\")\n    .text(fiTitle);\n\n  FI.append(\"text\")\n      .attr(\"x\", plotLeft)\n      .attr(\"y\", plotTop - 15)\n      .attr(\"class\", \"smallTitle\")\n      .text(modelName);\n\n  // tooltip\n  var tool_tip = d3.tip()\n        .attr(\"class\", \"tooltip\")\n        .offset([-8, 0])\n        .html(d => fiStaticTooltipHtml(modelName,d));\n  svg.call(tool_tip);\n\n  // bars\n  var bars = FI.selectAll()\n               .data(bData)\n               .enter()\n               .append(\"g\");\n\n  // find full model dropout_loss value\n  var fullModel = bData[0].full_model;\n\n  bars.append(\"rect\")\n      .attr(\"class\", modelName.replace(/\\s/g,''))\n      .attr(\"fill\", barColor)\n      .attr(\"y\", d => y(d.variable))\n      .attr(\"height\", y.bandwidth())\n      .attr(\"x\", function (d) {\n        // start ploting the bar left to full model line\n        if (x(d.dropout_loss) < x(fullModel)) {\n          return x(d.dropout_loss);\n        } else {\n          return x(fullModel);\n        }\n      })\n      .attr(\"width\", d => Math.abs(x(d.dropout_loss) - x(fullModel)))\n      .on('mouseover', tool_tip.show)\n      .on('mouseout', tool_tip.hide);\n\n  // make line next to bars\n  var minimumY = Number.MAX_VALUE;\n  var maximumY = Number.MIN_VALUE;\n  bars.selectAll(\".\".concat(modelName.replace(/\\s/g,''))).each(function() {\n    if(+this.getAttribute('y') < minimumY) {\n      minimumY = +this.getAttribute('y');\n    }\n    if(+this.getAttribute('y') > maximumY) {\n      maximumY = +this.getAttribute('y');\n    }\n  });\n\n  FI.append(\"line\")\n    .attr(\"class\", \"interceptLine\")\n    .attr(\"x1\", x(fullModel))\n    .attr(\"y1\", minimumY)\n    .attr(\"x2\", x(fullModel))\n    .attr(\"y2\", maximumY + y.bandwidth());\n}\n\nfunction partialDependency() {\n  //TODO\n}\n\nfunction updateCP(clicked) {\n  plotLeft = 80;\n\n  if (clicked === \"-1\" || clicked === `${bdBarCount-2}` ||\n  (bdData.otherFactorsFlag[0] === true && clicked === `${bdBarCount-3}`)){ return;}\n\n  var profData = cpData.x;\n  var xMinMax = cpData.x_min_max_list;\n  var yMinMax = cpData.y_min_max;\n  var obsData = cpData.observation;\n  var isNumeric = cpData.is_numeric;\n  var variables = cpData.variables;\n\n  let variableName = variables[clicked];\n  CP.selectAll(\"*\").remove();\n\n  //lines or bars?\n  if (isNumeric[clicked]) {\n    cpNumericalPlot(variableName, profData[variableName], xMinMax[variableName],\n                    yMinMax, obsData);\n  } else {\n    cpCategoricalPlot(variableName, profData[variableName],\n                      yMinMax, obsData);\n  }\n  svg.selectAll(\"text\")\n      .style('font-family', 'Fira Sans, sans-serif');\n}\n\nfunction cpNumericalPlot(variableName, lData, mData, yMinMax, pData) {\n\n  var x = d3.scaleLinear()\n            .range([plotLeft + 10, plotLeft + cpPlotWidth - 10])\n            .domain([mData[0], mData[1]]);\n\n  var y = d3.scaleLinear()\n            .range([plotTop + cpPlotHeight, plotTop])\n            .domain([yMinMax[0], yMinMax[1]]);\n\n  var line = d3.line()\n               .x(function(d) { return x(d.xhat); })\n               .y(function(d) { return y(d.yhat); })\n               .curve(d3.curveMonotoneX);\n\n  CP.append(\"text\")\n      .attr(\"class\", \"bigTitle\")\n      .attr(\"x\", plotLeft)\n      .attr(\"y\", plotTop - 40)\n      .text(cpTitle);\n\n  CP.append(\"text\")\n      .attr(\"class\",\"smallTitle\")\n      .attr(\"x\", plotLeft)\n      .attr(\"y\", plotTop - 15)\n      .text(variableName + \" = \" + pData[0][variableName]);\n\n  // find 5 nice ticks with max and min - do better than d3\n  var tickValues = getTickValues(x.domain());\n\n  var xAxis = d3.axisBottom(x)\n              .tickValues(tickValues)\n              .tickSizeInner(0)\n              .tickPadding(15);\n\n  xAxis = CP.append(\"g\")\n              .attr(\"class\", \"axisLabel\")\n              .attr(\"transform\", \"translate(0,\"+ (plotTop + cpPlotHeight) + \")\")\n              .call(xAxis);\n\n  var yGrid = CP.append(\"g\")\n             .attr(\"class\", \"grid\")\n             .attr(\"transform\", \"translate(\" + plotLeft + \",0)\")\n             .call(d3.axisLeft(y)\n                    .ticks(10)\n                    .tickSize(-cpPlotWidth)\n                    .tickFormat(\"\")\n            ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n          .ticks(5)\n          .tickSize(0);\n\n  yAxis = CP.append(\"g\")\n          .attr(\"class\", \"axisLabel\")\n          .attr(\"transform\",\"translate(\" + plotLeft + \",0)\")\n          .call(yAxis)\n          .call(g => g.select(\".domain\").remove());\n\n  // make tooltip\n  var tool_tip = d3.tip()\n            .attr(\"class\", \"tooltip\")\n            .offset([-8, 0])\n            .html(function(d, addData) {\n              if(addData !== undefined){\n                return cpChangedTooltipHtml(d, addData);\n              } else {\n                return cpStaticTooltipHtml(d);\n              }\n            });\n  svg.call(tool_tip);\n\n  // function to find nearest point on the line\n  var bisectXhat = d3.bisector(d => d.xhat).right;\n\n  // tooltip appear with info nearest to mouseover\n  function appear(data){\n    var x0 = x.invert(d3.mouse(d3.event.currentTarget)[0]),\n        i = bisectXhat(data, x0),\n        d0 = data[i - 1],\n        d1 = data[i],\n        d = x0 - d0.xhat > d1.xhat - x0 ? d1 : d0;\n    let temp = pData.find(el => el[\"observation.id\"] === d.id);\n    tool_tip.show(d, temp);\n  }\n\n  // add lines\n  CP.append(\"path\")\n    .data([lData])\n    .attr(\"class\", \"line \" + variableName)\n    .attr(\"d\", line)\n    .style(\"fill\", \"none\")\n    .style(\"stroke\", lineColor)\n    .style(\"opacity\", alpha)\n    .style(\"stroke-width\", size)\n    .on('mouseover', function(d){\n\n      d3.select(this)\n        .style(\"stroke\", pointColor)\n        .style(\"stroke-width\", size*1.5);\n\n      // make line and points appear on top\n      this.parentNode.appendChild(this);\n      d3.select(this.parentNode).selectAll(\".point\").each(function() {\n                       this.parentNode.appendChild(this);\n                  });\n\n      // show changed tooltip\n      appear(d);\n    })\n    .on('mouseout', function(d){\n\n      d3.select(this)\n        .style(\"stroke\", lineColor)\n        .style(\"stroke-width\", size);\n\n      // hide changed tooltip\n      tool_tip.hide(d);\n    });\n\n  // add points\n  CP.selectAll()\n        .data(pData)\n        .enter()\n        .append(\"circle\")\n        .attr(\"class\", \"point\")\n        .attr(\"id\", d => d[\"observation.id\"])\n        .attr(\"cx\", d => x(d[variableName]))\n        .attr(\"cy\", d => y(d.yhat))\n        .attr(\"r\", 3)\n        .style(\"stroke-width\", 15)\n        .style(\"stroke\", \"red\")\n        .style(\"stroke-opacity\", 0)\n        .style(\"fill\", pointColor)\n        .on('mouseover', function(d) {\n          tool_tip.show(d);\n      \t\td3.select(this)\n      \t\t\t.attr(\"r\", 6);\n      \t})\n        .on('mouseout', function(d) {\n          tool_tip.hide(d);\n      \t\td3.select(this)\n      \t\t\t.attr(\"r\", 3);\n      \t});\n\n  if (showRugs === true) {\n    // add rugs\n    CP.selectAll()\n      .data(pData)\n      .enter()\n      .append(\"line\")\n      .attr(\"class\", \"rugLine\")\n      .style(\"stroke\", \"red\")\n      .style(\"stroke-width\", 2)\n      .attr(\"x1\", d => x(d[variableName]))\n      .attr(\"y1\", plotTop + cpPlotHeight)\n      .attr(\"x2\", d => x(d[variableName]))\n      .attr(\"y2\", plotTop + cpPlotHeight - 10);\n  }\n\n  CP.append(\"text\")\n        .attr(\"class\", \"axisTitle\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", plotLeft-40)\n        .attr(\"x\", -(plotTop + cpPlotHeight/2))\n        .attr(\"text-anchor\", \"middle\")\n        .text(\"prediction\");\n}\n\nfunction cpCategoricalPlot(variableName, bData, yMinMax, lData) {\n\n  var x = d3.scaleLinear()\n        .range([plotLeft,  plotLeft + cpPlotWidth])\n        .domain([yMinMax[0], yMinMax[1]]);\n\n  var xAxis = d3.axisBottom(x)\n                .ticks(5)\n                .tickSize(0);\n\n  xAxis = CP.append(\"g\")\n          .attr(\"class\", \"axisLabel\")\n          .attr(\"transform\", \"translate(0,\" + (plotTop + cpPlotHeight) + \")\")\n          .call(xAxis)\n          .call(g => g.select(\".domain\").remove());\n\n  var y = d3.scaleBand()\n        .rangeRound([plotTop + cpPlotHeight, plotTop])\n        .padding(0.33)\n        .domain(bData.map(function (d) {\n             return d.xhat;\n        }));\n\n  var xGrid = CP.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(0,\" + (plotTop + cpPlotHeight) + \")\")\n         .call(d3.axisBottom(x)\n                .ticks(10)\n                .tickSize(-cpPlotHeight)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yGrid = CP.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(\" + plotLeft + \",0)\")\n         .call(d3.axisLeft(y)\n                .tickSize(-cpPlotWidth)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n        .tickSize(0);\n\n  yAxis = CP.append(\"g\")\n        .attr(\"class\", \"axisLabel\")\n        .attr(\"transform\",\"translate(\" + (plotLeft-8) + \",0)\")\n        .call(yAxis)\n        .call(g => g.select(\".domain\").remove());\n\n  CP.append(\"text\")\n        .attr(\"x\", plotLeft)\n        .attr(\"y\", plotTop - 15)\n        .attr(\"class\", \"smallTitle\")\n        .text(variableName + \" = \" + lData[0][variableName]);\n\n  CP.append(\"text\")\n        .attr(\"x\", plotLeft)\n        .attr(\"y\", plotTop - 40)\n        .attr(\"class\", \"bigTitle\")\n        .text(cpTitle);\n\n  var bars = CP.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  var fullModel = lData[0].yhat;\n\n  // make tooltip\n  var tool_tip = d3.tip()\n        .attr(\"class\", \"tooltip\")\n        .offset([-8, 0])\n        .html(function(d) { return cpChangedTooltipHtml(d, lData[0]); });\n  svg.call(tool_tip);\n\n  // add bars\n  bars.append(\"rect\")\n        .attr(\"class\", variableName)\n        .attr(\"fill\", lineColor)\n        .attr(\"y\", function (d) {\n            return y(d.xhat);\n        })\n        .attr(\"height\", y.bandwidth())\n        .attr(\"x\", function (d) {\n          // start ploting the bar left to full model line\n          if (x(d.yhat) < x(fullModel)) {\n            return x(d.yhat);\n          } else {\n            return x(fullModel);\n          }\n        })\n        .attr(\"width\", function (d) {\n            return  Math.abs(x(d.yhat) - x(fullModel));\n        })\n        .on('mouseover', tool_tip.show)\n        .on('mouseout', tool_tip.hide);\n\n  // add intercept line\n  var minimumY = Number.MAX_VALUE;\n  var maximumY = Number.MIN_VALUE;\n\n  bars.selectAll(\".\".concat(variableName)).each(function() {\n      if(+this.getAttribute('y') < minimumY) {\n        minimumY = +this.getAttribute('y');\n      }\n      if(+this.getAttribute('y') > maximumY) {\n        maximumY = +this.getAttribute('y');\n      }\n    });\n\n  CP.append(\"line\")\n        .attr(\"class\", \"interceptLine\")\n        .attr(\"x1\", x(fullModel))\n        .attr(\"y1\", minimumY)\n        .attr(\"x2\", x(fullModel))\n        .attr(\"y2\", maximumY + y.bandwidth());\n\n  CP.append(\"text\")\n        .attr(\"transform\",\n              \"translate(\" + (plotLeft + cpPlotWidth + margin.right)/2 + \" ,\" +\n                             (plotTop + cpPlotHeight + 45) + \")\")\n        .attr(\"class\", \"axisTitle\")\n        .text(\"prediction\");\n}\n\nfunction bdTooltipHtml(d, prediction) {\n  var temp = \"<center>\";\n  temp += d.tooltipText;\n  temp += \"<\/center>\";\n  return temp;\n}\n\nfunction cpStaticTooltipHtml(d, addData) {\n  // function formats tooltip text\n  var temp = \"\";\n  for (var [k, v] of Object.entries(d)) {\n    if (k === \"yhat\") {\n      k = \"prediction\";\n      temp += \"<center>\" +  k + \": \" + v + \"<\/br>\";\n      temp += \"<\/br>\";\n    } else{\n      temp += \"<center>\" +  k + \": \" + v + \"<\/br>\";\n    }\n  }\n  return temp;\n}\n\nfunction cpChangedTooltipHtml(d, addData) {\n  // function formats tooltip text with update in red\n  var temp = \"<center>\";\n  for (var [k, v] of Object.entries(addData)) {\n    if (k === \"yhat\") {\n      temp += \"prediction:<\/br>\";\n      temp += \"- before\" + \": \" + v + \"<\/br>\";\n      temp += \"- after\" + \": \" + \"<font color = \\\"red\\\">\" + d.yhat + \"<\/br><\/font>\";\n      temp += \"<\/br>\";\n    } else if (k === d.vname) {\n      temp +=  k + \": \" + \"<font color = \\\"red\\\">\"  +  d.xhat + \"<\/br><\/font>\";\n    } else {\n      temp += k + \": \" + v + \"<\/br>\";\n    }\n  }\n  temp += \"<\/center>\";\n  return temp;\n}\n\nfunction fiStaticTooltipHtml(modelName, d){\n    let sign;\n    if (d.dropout_loss > d.full_model) sign = \"+\"; else sign = \"\";\n    var temp =\"Model: \" + modelName\n      + \"<\/br>\" +\n      \"Model loss after feature \" + d.variable\n      + \"<\/br>\" +\n      \" is permuted: \" +  Math.round(d.dropout_loss * 1000)/1000\n      + \"<\/br>\" +\n      \"Drop-out loss change: \"  + sign + Math.round((d.dropout_loss - d.full_model) * 1000)/1000 ;\n    return temp;\n}\n\nsvg.selectAll(\"text\")\n  .style('font-family', 'Fira Sans, sans-serif');\n};","style":"/* R2D3 Source File:  C:/Users/Hubert/Documents/R/win-library/3.6/dime/d3js/themeDrWhy.css */\n@import url('https://fonts.googleapis.com/css?family=Fira+Sans:400,600');\n\ntext {\n    fill: #371ea3;\n}\n\n.bigTitle {\n    font-weight: 600;\n    font-size: 18px;\n    text-align: left;\n}\n\n.smallTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: left;\n}\n\n.axisTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: center;\n}\n\n.axisLabel{\n    font-weight:400;\n    font-size: 11px;\n}\n\n.axisLabel .domain{\n    stroke: #371ea3;\n}\n\n.legendTitle{\n    font-weight: 400;\n    font-size: 13px;\n    text-align: left;\n}\n\n.interceptLine{\n    stroke: #371ea3;\n\tstroke-width: 1px;\n\tstroke-opacity: 1;\n\tstroke-linecap: \"butt\";\n}\n\n.dotLine{\n  \t\tfill: none;\n  \t\tstroke: #371ea3;\n  \t\tstroke-width: 0.7px;\n}\n\n.grid .tick line{\n    stroke: #f0f0f4;\n    stroke-width: 1px\n}\n\n.d3-tip {\n    line-height: 1.1;\n    padding: 6px;\n    background: #00000080;\n    color: #fff;\n    border-radius: 0px;\n    font-size: 14px;\n    font-family: 'Roboto Condensed', sans-serif;\n}\n\n/* Creates a small triangle extender for the tooltip */\n.d3-tip:after {\n    box-sizing: border-box;\n    display: inline;\n    font-size: 10px;\n    width: 100%;\n    line-height: 1;\n    color: rgba(0, 0, 0, 0.8);\n    content: \"\\25BC\";\n    position: absolute;\n    text-align: center;\n}\n\n/* Style northward tooltips specifically */\n.d3-tip.n:after {\n    margin: -2px 0 0 0;\n    top: 100%;\n    left: 0;\n}","version":4,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":{"background":"#FFFFFF","foreground":"#000000"}},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-89d54e9a9748ca0f396c">{"viewer":{"width":450,"height":350,"padding":15,"fill":true},"browser":{"width":960,"height":500,"padding":40,"fill":true}}</script>
</body>
</html>
